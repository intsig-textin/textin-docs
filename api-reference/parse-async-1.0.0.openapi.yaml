openapi: 3.0.3
info:
  title: XParse Parse Async API
  description: |
    ç‹¬ç«‹çš„æ–‡æ¡£è§£æå¼‚æ­¥APIæ¥å£ï¼Œæ”¯æŒå¼‚æ­¥å¤„ç†æ–‡æ¡£è§£æä»»åŠ¡ã€‚
    
    è¯¥APIé€‚ç”¨äºå¤„ç†å¤§æ–‡ä»¶æˆ–æ‰¹é‡æ–‡ä»¶ï¼Œé€šè¿‡job_idæŸ¥è¯¢å¤„ç†çŠ¶æ€å’Œç»“æœï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…ã€‚
  version: 1.0.0
  contact:
    name: TextIn API Team

servers:
  - url: https://api.textin.com
    description: ç”Ÿäº§ç¯å¢ƒ

security:
  - AppIdAuth: []
    SecretCodeAuth: []

paths:
  /api/xparse/parse/async:
    post:
      summary: åˆ›å»ºå¼‚æ­¥è§£æä»»åŠ¡
      description: |
        åˆ›å»ºå¼‚æ­¥æ–‡æ¡£è§£æä»»åŠ¡ï¼Œç«‹å³è¿”å›job_idï¼Œé€šè¿‡job_idæŸ¥è¯¢å¤„ç†çŠ¶æ€å’Œç»“æœã€‚
        
        é€‚ç”¨äºå¤„ç†å¤§æ–‡ä»¶æˆ–æ‰¹é‡æ–‡ä»¶ï¼Œé¿å…HTTPè¶…æ—¶é™åˆ¶ã€‚
      operationId: createParseAsyncJob
      tags:
        - XParse Parse
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: éœ€è¦å¤„ç†çš„æ–‡æ¡£æ–‡ä»¶ï¼ˆæ”¯æŒ PDFã€WORDã€EXCELã€PPTã€å›¾ç‰‡ç­‰[å¤šç§æ ¼å¼](/pipeline/sources/overview#æ”¯æŒçš„æ–‡ä»¶æ ¼å¼)ï¼‰
                config:
                  type: string
                  description: |
                    Parseé…ç½®çš„ JSON å­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼‰ï¼Œä¸Pipeline ParseèŠ‚ç‚¹é…ç½®ä¸€è‡´ã€‚
                    
                    å¦‚æœæœªæä¾›ï¼Œå°†ä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆprovider: "textin"ï¼‰ã€‚
                    
                    é…ç½®æ ¼å¼å‚è€ƒ[æ–‡æ¡£è§£æ - Parse](/pipeline/parse)ã€‚
                  example: '{"provider": "textin", "parse_mode": "auto"}'
                webhook:
                  type: string
                  description: |
                    Webhookå›è°ƒURLï¼ˆå¯é€‰ï¼‰ï¼Œå½“ä»»åŠ¡å®Œæˆæˆ–å¤±è´¥æ—¶ä¼šè°ƒç”¨è¯¥URLã€‚
                    
                    Webhookè¯·æ±‚æ ¼å¼ï¼š
                    - Method: POST
                    - Content-Type: application/json
                    - Body: {"job_id": "xxx", "status": "completed", "result_url": "https://..."}
                  example: "https://your-server.com/webhook"
            encoding:
              config:
                contentType: application/json
      responses:
        '200':
          description: ä»»åŠ¡åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/codemessage'
                  - $ref: '#/components/schemas/CreateJobResponse'
              examples:
                success:
                  summary: æˆåŠŸç¤ºä¾‹
                  value:
                    code: 200
                    msg: "success"
                    data:
                      job_id: "xxx"
                error:
                  summary: é”™è¯¯ç¤ºä¾‹
                  value:
                    code: 40004
                    msg: "Parameter error"
                    data:
                      message: "File not uploaded"
  
  /api/xparse/parse/async/{job_id}:
    get:
      summary: æŸ¥è¯¢å¼‚æ­¥è§£æä»»åŠ¡çŠ¶æ€
      description: |
        é€šè¿‡job_idæŸ¥è¯¢å¼‚æ­¥è§£æä»»åŠ¡çš„å¤„ç†çŠ¶æ€å’Œç»“æœã€‚
        
        ä»»åŠ¡çŠ¶æ€åŒ…æ‹¬ï¼š
        - pending: æ’é˜Ÿä¸­
        - in_progress: å¤„ç†ä¸­
        - completed: å·²å®Œæˆ
        - failed: å¤„ç†å¤±è´¥
      operationId: getParseAsyncJobStatus
      tags:
        - XParse Parse
      parameters:
        - name: job_id
          in: path
          required: true
          description: ä»»åŠ¡ID
          schema:
            type: string
          example: "xxx"
      responses:
        '200':
          description: ä»»åŠ¡çŠ¶æ€
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/codemessage'
                  - $ref: '#/components/schemas/JobStatusResponse'
              examples:
                pending:
                  summary: æ’é˜Ÿä¸­
                  value:
                    code: 200
                    msg: "success"
                    data:
                      job_id: "xxx"
                      file_id: "xxx"
                      status: "pending"
                in_progress:
                  summary: å¤„ç†ä¸­
                  value:
                    code: 200
                    msg: "success"
                    data:
                      job_id: "xxx"
                      file_id: "xxx"
                      status: "in_progress"
                completed:
                  summary: å·²å®Œæˆ
                  value:
                    code: 200
                    msg: "success"
                    data:
                      job_id: "xxx"
                      file_id: "xxx"
                      status: "completed"
                      result_url: "https://api.textin.com/api/xparse/parse/async/result/xxx"
                failed:
                  summary: å¤„ç†å¤±è´¥
                  value:
                    code: 200
                    msg: "success"
                    data:
                      job_id: "xxx"
                      file_id: "xxx"
                      status: "failed"
                      message: "error msg"
  
  /api/xparse/parse/async/result/{job_id}:
    get:
      summary: æŸ¥è¯¢å¼‚æ­¥è§£æä»»åŠ¡ç»“æœ
      description: |
        é€šè¿‡job_idæŸ¥è¯¢å¼‚æ­¥è§£æä»»åŠ¡çš„è¯¦ç»†ç»“æœã€‚
        
        è¯¥æ¥å£ä»…åœ¨ä»»åŠ¡çŠ¶æ€ä¸ºcompletedæ—¶å¯ç”¨ï¼Œè¿”å›å®Œæ•´çš„è§£æç»“æœï¼Œæ ¼å¼ä¸åŒæ­¥APIä¸€è‡´ã€‚
      operationId: getParseAsyncJobResult
      tags:
        - XParse Parse
      parameters:
        - name: job_id
          in: path
          required: true
          description: ä»»åŠ¡ID
          schema:
            type: string
          example: "xxx"
      responses:
        '200':
          description: è§£æç»“æœ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/codemessage'
                  - $ref: '#/components/schemas/ParseResultResponse'
              examples:
                success:
                  summary: æˆåŠŸç¤ºä¾‹
                  value:
                    code: 200
                    msg: "success"
                    data:
                      file_id: "xxx"
                      elements:
                        - element_id: "13a9939f23e485ca20a16c741658bcf64efd82309a6f0a8cf35679a65b2fd0dc"
                          type: "NarrativeText"
                          metadata:
                            filename: "example.pdf"
                            filetype: "application/pdf"
                            last_modified: "1758624866230"
                            page_number: 1
                            page_width: 1191
                            page_height: 1684
                          text: "è¿™æ˜¯è§£æå‡ºçš„æ–‡æœ¬å†…å®¹"
                notReady:
                  summary: ä»»åŠ¡æœªå®Œæˆ
                  value:
                    code: 40004
                    msg: "Parameter error"
                    data:
                      message: "Job is not completed yet"

components:
  securitySchemes:
    AppIdAuth:
      type: apiKey
      in: header
      name: x-ti-app-id
      description: 'è¯·[ç™»å½•Textin](https://www.textin.com/console/dashboard/setting)åå‰å¾€ "å·¥ä½œå°-è´¦å·è®¾ç½®-å¼€å‘è€…ä¿¡æ¯" æŸ¥çœ‹ x-ti-app-id'
    SecretCodeAuth:
      type: apiKey
      in: header
      name: x-ti-secret-code
      description: 'è¯·[ç™»å½•Textin](https://www.textin.com/console/dashboard/setting)åå‰å¾€ "å·¥ä½œå°-è´¦å·è®¾ç½®-å¼€å‘è€…ä¿¡æ¯" æŸ¥çœ‹ x-ti-secret-code'

  schemas:
    codemessage:
      type: object
      required:
        - code
        - msg
      properties:
        code:
          type: integer
          default: 200
          description: |
            çŠ¶æ€ç 
            - 200: Success
            - 40101: x-ti-app-id æˆ– x-ti-secret-code ä¸ºç©º
            - 40102: x-ti-app-id æˆ– x-ti-secret-code æ— æ•ˆï¼ŒéªŒè¯å¤±è´¥
            - 40004: å‚æ•°é”™è¯¯ï¼Œè¯·æŸ¥çœ‹æŠ€æœ¯æ–‡æ¡£ï¼Œæ£€æŸ¥ä¼ å‚
            - 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
            
            æ›´å¤šè¯¦ç»†é”™è¯¯ä¿¡æ¯å‚è€ƒ[é”™è¯¯ç è¯´æ˜](/pipeline/error)ã€‚
          enum:
            - 200
            - 40101
            - 40102
            - 40004
            - 500
        msg:
          type: string
          description: é”™è¯¯ä¿¡æ¯
          example: "success"
    
    CreateJobResponse:
      type: object
      required:
        - data
      properties:
        data:
          $ref: '#/components/schemas/CreateJobData'
    
    CreateJobData:
      type: object
      required:
        - job_id
      properties:
        job_id:
          type: string
          description: ä»»åŠ¡IDï¼Œç”¨äºæŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
          example: "xxx"
    
    JobStatusResponse:
      type: object
      required:
        - data
      properties:
        data:
          $ref: '#/components/schemas/JobStatusData'
    
    JobStatusData:
      type: object
      required:
        - job_id
        - file_id
        - status
      properties:
        job_id:
          type: string
          description: ä»»åŠ¡ID
          example: "xxx"
        file_id:
          type: string
          description: æ–‡ä»¶ID
          example: "xxx"
        status:
          type: string
          description: |
            ä»»åŠ¡çŠ¶æ€
            - pending: æ’é˜Ÿä¸­
            - in_progress: å¤„ç†ä¸­
            - completed: å·²å®Œæˆ
            - failed: å¤„ç†å¤±è´¥
          enum: [pending, in_progress, completed, failed]
          example: "completed"
        result_url:
          type: string
          description: |
            ç»“æœä¸‹è½½URLï¼ˆä»…åœ¨statusä¸ºcompletedæ—¶è¿”å›ï¼‰
            
            é€šè¿‡è¯¥URLå¯ä»¥ä¸‹è½½è§£æç»“æœï¼Œç»“æœæ ¼å¼ä¸åŒæ­¥APIä¸€è‡´ã€‚
          example: "https://api.textin.com/api/xparse/parse/async/result/xxx"
        message:
          type: string
          description: é”™è¯¯ä¿¡æ¯ï¼ˆä»…åœ¨statusä¸ºfailedæ—¶è¿”å›ï¼‰
          example: "error msg"

tags:
  - name: XParse Parse
    description: |
      ç‹¬ç«‹çš„æ–‡æ¡£è§£æå¼‚æ­¥APIæ¥å£
      
      ## åŠŸèƒ½ç‰¹æ€§
      - ğŸ“„ å¼‚æ­¥å¤„ç†ï¼šæ”¯æŒå¤§æ–‡ä»¶å’Œæ‰¹é‡æ–‡ä»¶å¤„ç†
      - ğŸ”” Webhookæ”¯æŒï¼šæ”¯æŒä»»åŠ¡å®Œæˆå›è°ƒé€šçŸ¥
      - ğŸ“Š çŠ¶æ€æŸ¥è¯¢ï¼šé€šè¿‡job_idæŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
      - â±ï¸ æ— è¶…æ—¶é™åˆ¶ï¼šé¿å…HTTPè¶…æ—¶é—®é¢˜
      
      ## è®¡è´¹è¯´æ˜
      - æŒ‰ç…§å¤„ç†çš„é¡µæ•°è®¡è´¹
      - è®¡è´¹ä¿¡æ¯é€šè¿‡ x-ti-app-id å’Œ x-ti-secret-code è¿›è¡Œå…³è”
