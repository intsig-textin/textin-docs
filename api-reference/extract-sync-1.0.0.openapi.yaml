openapi: 3.0.3
info:
  title: XParse Extract Sync API
  description: |
    ç‹¬ç«‹çš„ä¿¡æ¯æŠ½å–åŒæ­¥APIæ¥å£ï¼Œæ”¯æŒä»æ–‡æ¡£ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯ã€‚
    
    è¯¥APIå†…éƒ¨ä¼šè‡ªåŠ¨è°ƒç”¨Parseè¿›è¡Œæ–‡æ¡£è§£æï¼Œç„¶åæ ¹æ®æä¾›çš„schemaè¿›è¡Œä¿¡æ¯æŠ½å–ã€‚
  version: 1.0.0
  contact:
    name: TextIn API Team

servers:
  - url: https://api.textin.com
    description: ç”Ÿäº§ç¯å¢ƒ

security:
  - AppIdAuth: []
    SecretCodeAuth: []

paths:
  /api/xparse/extract/sync:
    post:
      summary: åŒæ­¥æ–‡æ¡£æŠ½å–
      description: |
        åŒæ­¥æ‰§è¡Œæ–‡æ¡£æŠ½å–ï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨è°ƒç”¨Parseè¿›è¡Œæ–‡æ¡£è§£æï¼Œç„¶åæ ¹æ®æä¾›çš„schemaè¿›è¡Œä¿¡æ¯æŠ½å–ã€‚
        
        è¯¥æ¥å£ä¼šç«‹å³è¿”å›æŠ½å–ç»“æœï¼Œé€‚ç”¨äºå°æ–‡ä»¶æˆ–éœ€è¦åŒæ­¥è·å–ç»“æœçš„åœºæ™¯ã€‚
      operationId: extractSync
      tags:
        - XParse Extract
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
                - extract_config
              properties:
                file:
                  type: string
                  format: binary
                  description: éœ€è¦å¤„ç†çš„æ–‡æ¡£æ–‡ä»¶ï¼ˆæ”¯æŒ PDFã€WORDã€EXCELã€PPTã€å›¾ç‰‡ç­‰[å¤šç§æ ¼å¼](/pipeline/sources/overview#æ”¯æŒçš„æ–‡ä»¶æ ¼å¼)ï¼‰
                parse_config:
                  type: string
                  description: |
                    Parseé…ç½®çš„ JSON å­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼‰ï¼Œä¸Pipeline ParseèŠ‚ç‚¹é…ç½®ä¸€è‡´ã€‚
                    
                    å¦‚æœæœªæä¾›ï¼Œå°†ä½¿ç”¨é»˜è®¤çš„Parseé…ç½®ï¼ˆprovider: "textin"ï¼‰ã€‚
                    
                    é…ç½®æ ¼å¼å‚è€ƒ[æ–‡æ¡£è§£æ - Parse](/pipeline/parse)ã€‚
                  example: '{"provider": "textin", "parse_mode": "auto"}'
                extract_config:
                  type: string
                  description: |
                    æŠ½å–é…ç½®çš„ JSON å­—ç¬¦ä¸²ï¼ˆå¿…å¡«ï¼‰ï¼Œä¸Pipeline ExtractèŠ‚ç‚¹é…ç½®ä¸€è‡´ã€‚
                    
                    å¿…é¡»åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
                    - schema: JSON Schemaå®šä¹‰ï¼Œç”¨äºæŒ‡å®šè¦æŠ½å–çš„å­—æ®µç»“æ„
                    - generate_citations: æ˜¯å¦ç”Ÿæˆå¼•ç”¨ä¿¡æ¯ï¼ˆåæ ‡ä½ç½®ï¼‰ï¼Œé»˜è®¤ false
                    - stamp: æ˜¯å¦è°ƒç”¨å°ç« è¯†åˆ«ï¼Œé»˜è®¤ false
                    
                    é…ç½®æ ¼å¼å‚è€ƒ[ä¿¡æ¯æŠ½å– - Extract](/pipeline/extract)ã€‚
                  example: '{"schema": {"type": "object", "properties": {"å•†å“": {"type": ["string","null"], "description": ""}}, "required": ["å•†å“"]}, "generate_citations": false, "stamp": false}'
            encoding:
              parse_config:
                contentType: application/json
              extract_config:
                contentType: application/json
      responses:
        '200':
          description: æŠ½å–ç»“æœ
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/codemessage'
                  - $ref: '#/components/schemas/ExtractSyncResponse'
              examples:
                success:
                  summary: æˆåŠŸç¤ºä¾‹
                  value:
                    code: 200
                    msg: "success"
                    data:
                      file_id: "xxx"
                      status: "completed"
                      result:
                        success_count: 1
                        extracted_schema:
                          å•†å“: "ç«¥è£… Looney Tunes UTï¼ˆçŸ­è¢–Tæ¤ï¼‰å¥³è£…SUPIMA COTTONåœ†é¢†Tæ¤ï¼ˆçŸ­è¢–ï¼‰"
                        citations:
                          å•†å“:
                            value: "ç«¥è£… Looney Tunes UTï¼ˆçŸ­è¢–Tæ¤ï¼‰å¥³è£…SUPIMA COTTONåœ†é¢†Tæ¤ï¼ˆçŸ­è¢–ï¼‰"
                            bounding_regions:
                              - page_number: 1
                                position: [137, 599, 1129, 599, 1129, 625, 182, 625]
                                text: "ç«¥è£… Looney Tunes UTï¼ˆçŸ­è¢–Tæ¤ï¼‰"
                        pages:
                          - page_number: 1
                            image_id: "62bfe3c3a8e9c9cf.jpg"
                            height: 1824
                            width: 600
                            angle: 0
                            status: "Success"
                            durations: 930.178466796875
                        stamps: []
                error:
                  summary: é”™è¯¯ç¤ºä¾‹
                  value:
                    code: 40004
                    msg: "Parameter error"
                    data:
                      file_id: "xxx"
                      status: "failed"
                      message: "extract_config is required"

components:
  securitySchemes:
    AppIdAuth:
      type: apiKey
      in: header
      name: x-ti-app-id
      description: 'è¯·[ç™»å½•Textin](https://www.textin.com/console/dashboard/setting)åå‰å¾€ "å·¥ä½œå°-è´¦å·è®¾ç½®-å¼€å‘è€…ä¿¡æ¯" æŸ¥çœ‹ x-ti-app-id'
    SecretCodeAuth:
      type: apiKey
      in: header
      name: x-ti-secret-code
      description: 'è¯·[ç™»å½•Textin](https://www.textin.com/console/dashboard/setting)åå‰å¾€ "å·¥ä½œå°-è´¦å·è®¾ç½®-å¼€å‘è€…ä¿¡æ¯" æŸ¥çœ‹ x-ti-secret-code'

  schemas:
    codemessage:
      type: object
      required:
        - code
        - msg
      properties:
        code:
          type: integer
          default: 200
          description: |
            çŠ¶æ€ç 
            - 200: Success (æˆåŠŸ)
            - 40101: x-ti-app-id æˆ– x-ti-secret-code ä¸ºç©º
            - 40102: x-ti-app-id æˆ– x-ti-secret-code æ— æ•ˆï¼ŒéªŒè¯å¤±è´¥
            - 40103: å®¢æˆ·ç«¯IPä¸åœ¨ç™½åå•
            - 40003: ä½™é¢ä¸è¶³ï¼Œè¯·å……å€¼åå†ä½¿ç”¨
            - 40004: Parameter error (å‚æ•°é”™è¯¯ï¼Œè¯·æ£€æŸ¥å…¥å‚ï¼‰
            - 40007: æœºå™¨äººä¸å­˜åœ¨æˆ–æœªå‘å¸ƒ
            - 40008: æœºå™¨äººæœªå¼€é€šï¼Œè¯·è‡³å¸‚åœºå¼€é€šåé‡è¯•
            - 40302: ä¸Šä¼ æ–‡ä»¶å¤§å°ä¸ç¬¦ï¼Œæ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 50M
            - 40303: æ–‡ä»¶ç±»å‹ä¸æ”¯æŒï¼Œæ¥å£ä¼šè¿”å›å®é™…æ£€æµ‹åˆ°çš„æ–‡ä»¶ç±»å‹ï¼Œå¦‚"å½“å‰æ–‡ä»¶ç±»å‹ä¸º.gif"
            - 40304: å›¾ç‰‡å°ºå¯¸ä¸ç¬¦ï¼Œé•¿å®½æ¯”å°äº2çš„å›¾ç‰‡å®½é«˜éœ€åœ¨20ï½20000åƒç´ èŒƒå›´å†…ï¼Œå…¶ä»–å›¾ç‰‡çš„å®½é«˜éœ€åœ¨20ï½10000åƒç´ èŒƒå›´å†…
            - 40305: File not uploaded (è¯†åˆ«æ–‡ä»¶æœªä¸Šä¼ ï¼‰
            - 40306: qpsè¶…è¿‡é™åˆ¶
            - 40400: æ— æ•ˆçš„è¯·æ±‚é“¾æ¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥æ˜¯å¦æ­£ç¡®
            - 40422: The file is corrupted (æ–‡ä»¶æŸå)
            - 40423: Password required or incorrect password (PDFå¯†ç é”™è¯¯)
            - 40424: Page number out of range (é¡µé¢è®¾ç½®è¶…å‡ºæ–‡ä»¶èŒƒå›´ï¼‰
            - 40425: The input file format is not supported (è¾“å…¥æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼‰
            - 40428: Process office file failed (wordå’Œpptè½¬pdfå¤±è´¥æˆ–è€…è¶…æ—¶)
            - 500: Engine failed (æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼‰
            - 50011: LLM Connection Failed ï¼ˆè®¿é—®å¤§æ¨¡å‹è¶…æ—¶ï¼‰
            - 50012: LLM Engine Failed (å¤§æ¨¡å‹å¼•æ“é”™è¯¯ï¼‰     
            - 50207: Partial failed (éƒ¨åˆ†é¡µé¢è§£æå¤±è´¥)
            
            æ›´å¤šè¯¦ç»†é”™è¯¯ä¿¡æ¯å‚è€ƒ[é”™è¯¯ç è¯´æ˜](/pipeline/error)ã€‚
          enum:
            - 200
            - 40101
            - 40102
            - 40103
            - 40003
            - 40004
            - 40007
            - 40008
            - 40302
            - 40303
            - 40304
            - 40305
            - 40306
            - 40400
            - 40422
            - 40423
            - 40424
            - 40425
            - 40428
            - 500
            - 50011
            - 50012
            - 50207
        msg:
          type: string
          description: é”™è¯¯ä¿¡æ¯
          example: "success"
    
    ExtractSyncResponse:
      type: object
      required:
        - data
      properties:
        data:
          $ref: '#/components/schemas/ExtractSyncData'
    
    ExtractSyncData:
      type: object
      required:
        - file_id
        - status
      properties:
        file_id:
          type: string
          description: æ–‡ä»¶ID
          example: "xxx"
        status:
          type: string
          description: å¤„ç†çŠ¶æ€
          enum: [completed, failed]
          example: "completed"
        result:
          type: object
          description: æŠ½å–ç»“æœï¼ˆä»…åœ¨statusä¸ºcompletedæ—¶è¿”å›ï¼‰
          $ref: '#/components/schemas/ExtractResult'
        message:
          type: string
          description: é”™è¯¯ä¿¡æ¯ï¼ˆä»…åœ¨statusä¸ºfailedæ—¶è¿”å›ï¼‰
          example: "error msg"
    
    ExtractResult:
      type: object
      description: Extracté˜¶æ®µè¿”å›çš„æŠ½å–ç»“æœï¼Œä¸extract v3å¯¹é½
      properties:
        success_count:
          type: integer
          description: æˆåŠŸå¤„ç†çš„æ–‡æ¡£é¡µæ•°
          example: 1
        extracted_schema:
          type: object
          description: |
            ç»“æ„åŒ–çš„æŠ½å–ç»“æœï¼Œä»¥jsonæ ¼å¼è¿”å›ï¼Œä¸æŠ½å–æ—¶ä¼ å…¥çš„schemaå®šä¹‰çš„ç»“æ„ä¸€è‡´ã€‚
            
            ç”±äºä½¿ç”¨ç»“æ„åŒ–æŠ½å–ï¼Œå…·ä½“çš„å­—æ®µåç§°å’Œæ•°æ®ç±»å‹ç”±ç”¨æˆ·çš„schemaå†³å®šï¼Œæ— æ³•é¢„å…ˆç¡®å®šã€‚
          additionalProperties: true
          example:
            å•†å“: "ç«¥è£… Looney Tunes UTï¼ˆçŸ­è¢–Tæ¤ï¼‰å¥³è£…SUPIMA COTTONåœ†é¢†Tæ¤ï¼ˆçŸ­è¢–ï¼‰"
        citations:
          type: object
          description: |
            æŠ½å–ç»“æœçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å«åæ ‡ä½ç½®ï¼Œç»“æ„ä¸schemaå®šä¹‰ä¸€è‡´ã€‚
            
            ä»…åœ¨ generate_citations=true æ—¶è¿”å›ã€‚æ¯ä¸ªæŠ½å–å­—æ®µçš„è¯¦ç»†ä¿¡æ¯åŒ…å«ï¼š
            - value: è¯¥å­—æ®µçš„æŠ½å–ç»“æœ
            - bounding_regions: æŠ½å–ç»“æœvalueå¯¹åº”çš„åæ ‡ä½ç½®
              - page_number: æ‰€åœ¨é¡µç ï¼Œä»1å¼€å§‹
              - text: è¾¹ç•Œæ¡†æ‰€åœ¨åŒºåŸŸå†…çš„æ–‡æœ¬å†…å®¹
              - position: åæ ‡ä½ç½®ï¼Œé•¿åº¦ä¸º8çš„æ•°ç»„ï¼Œè¡¨ç¤ºå››ä¸ªé¡¶ç‚¹çš„åƒç´ åæ ‡ [å·¦ä¸Šx, å·¦ä¸Šy, å³ä¸Šx, å³ä¸Šy, å³ä¸‹x, å³ä¸‹y, å·¦ä¸‹x, å·¦ä¸‹y]
          additionalProperties:
            type: object
            allOf:
              - $ref: '#/components/schemas/CitationItem'
        stamps:
          type: array
          description: å°ç« ç›¸å…³ä¿¡æ¯ï¼ˆä»…åœ¨ stamp=true ä¸”æ–‡æ¡£ä¸­åŒ…å«å°ç« æ—¶è¿”å›ï¼‰
          items:
            $ref: '#/components/schemas/StampInfo'
        pages:
          type: array
          description: æ–‡æ¡£é¡µé¢ç›¸å…³ä¿¡æ¯
          items:
            $ref: '#/components/schemas/PageInfo'
    
    CitationItem:
      type: object
      required:
        - value
        - bounding_regions
      properties:
        value:
          type: string
          nullable: true
          description: è¯¥å­—æ®µçš„æŠ½å–ç»“æœ
          example: "ç«¥è£… Looney Tunes UTï¼ˆçŸ­è¢–Tæ¤ï¼‰"
        bounding_regions:
          type: array
          description: æŠ½å–ç»“æœvalueå¯¹åº”çš„åæ ‡ä½ç½®
          items:
            $ref: '#/components/schemas/BoundingRegion'
    
    BoundingRegion:
      type: object
      required:
        - page_number
        - position
        - text
      properties:
        page_number:
          type: integer
          description: æ‰€åœ¨é¡µç ï¼Œä»1å¼€å§‹
          example: 1
        position:
          type: array
          description: |
            åæ ‡ä½ç½®ï¼Œé•¿åº¦ä¸º8çš„æ•°ç»„ï¼Œè¡¨ç¤ºå››ä¸ªé¡¶ç‚¹çš„åƒç´ åæ ‡
            [å·¦ä¸Šx, å·¦ä¸Šy, å³ä¸Šx, å³ä¸Šy, å³ä¸‹x, å³ä¸‹y, å·¦ä¸‹x, å·¦ä¸‹y]
          items:
            type: number
          minItems: 8
          maxItems: 8
          example: [137, 599, 1129, 599, 1129, 625, 182, 625]
        text:
          type: string
          description: è¾¹ç•Œæ¡†æ‰€åœ¨åŒºåŸŸå†…çš„æ–‡æœ¬å†…å®¹
          example: "ç«¥è£… Looney Tunes UTï¼ˆçŸ­è¢–Tæ¤ï¼‰"
    
    StampInfo:
      type: object
      description: å°ç« ç›¸å…³ä¿¡æ¯
      properties:
        color:
          type: string
          description: å½“å‰å°ç« é¢œè‰²
          enum: [çº¢è‰², è“è‰², é»‘è‰², å…¶ä»–]
          example: "çº¢è‰²"
        position:
          type: array
          description: å°ç« çš„åæ ‡ä¿¡æ¯ï¼Œé•¿åº¦ä¸º8çš„æ•°ç»„
          items:
            type: number
          minItems: 8
          maxItems: 8
        stamp_shape:
          type: string
          description: å½“å‰å°ç« å½¢çŠ¶
          enum: [åœ†ç« , æ¤­åœ†ç« , æ–¹ç« , ä¸‰è§’ç« , è±å½¢ç« , å…¶ä»–]
          example: "åœ†ç« "
        type:
          type: string
          description: å½“å‰å°ç« ç±»å‹
          enum: [å…¬ç« , ä¸ªäººç« , ä¸“ç”¨ç« , å…¶ä»–, åˆåŒä¸“ç”¨ç« , è´¢åŠ¡ä¸“ç”¨ç« , å‘ç¥¨ä¸“ç”¨ç« , ä¸šåŠ¡ä¸“ç”¨ç« ]
          example: "å…¬ç« "
        value:
          type: string
          description: å°ç« çš„æ–‡æœ¬å†…å®¹
          example: "æŸæŸå…¬å¸"
    
    PageInfo:
      type: object
      required:
        - page_number
        - status
        - durations
      properties:
        page_number:
          type: integer
          description: å½“å‰é¡µç 
          example: 1
        image_id:
          type: string
          description: å½“å‰é¡µé¢å›¾ç‰‡id
          example: "62bfe3c3a8e9c9cf.jpg"
        height:
          type: integer
          description: æ–‡æ¡£é¡µé¢é«˜åº¦
          example: 1824
        width:
          type: integer
          description: æ–‡æ¡£é¡µé¢å®½åº¦
          example: 600
        angle:
          type: integer
          description: é¡µé¢è§’åº¦ï¼ˆå¯é€‰å€¼0, 90, 180, 270ï¼‰
          enum: [0, 90, 180, 270]
          example: 0
        status:
          type: string
          description: å½“å‰é¡µå¤„ç†çŠ¶æ€
          example: "Success"
        durations:
          type: number
          description: å½“å‰é¡µå¤„ç†è€—æ—¶(æ¯«ç§’)
          example: 930.178466796875

tags:
  - name: XParse Extract
    description: |
      ç‹¬ç«‹çš„ä¿¡æ¯æŠ½å–APIæ¥å£
      
      ## åŠŸèƒ½ç‰¹æ€§
      - ğŸ“„ è‡ªåŠ¨è§£æï¼šå†…éƒ¨è‡ªåŠ¨è°ƒç”¨Parseè¿›è¡Œæ–‡æ¡£è§£æ
      - ğŸ“Š ç»“æ„åŒ–æŠ½å–ï¼šåŸºäºJSON Schemaçš„ç»“æ„åŒ–ä¿¡æ¯æŠ½å–
      - ğŸ“ åæ ‡ä¿¡æ¯ï¼šæ”¯æŒè¿”å›å­—æ®µçš„åæ ‡ä½ç½®ä¿¡æ¯
      - ğŸ” å°ç« è¯†åˆ«ï¼šæ”¯æŒè¯†åˆ«æ–‡æ¡£ä¸­çš„å°ç« ä¿¡æ¯
      
      ## è®¡è´¹è¯´æ˜
      - æŒ‰ç…§å¤„ç†çš„é¡µæ•°è®¡è´¹
      - è®¡è´¹ä¿¡æ¯é€šè¿‡ x-ti-app-id å’Œ x-ti-secret-code è¿›è¡Œå…³è”
