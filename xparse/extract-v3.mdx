---
title: "文档抽取v3"
---

## 概述

文档抽取v3是TextIn xParse推出的全新版本的文档抽取API。在文档抽取v3中，您可以自定义指定抽取模式（JSON schema）以及抽取模式中的字段和类型，系统会根据您的抽取模式进行抽取。如果您对文档抽取输出的结果字段类型有要求，例如区分文本和数字，那么文档抽取v3会非常有用。

通过定义JSON schema，文档抽取v3兼顾了抽取输出结果的稳定性，以及定义字段的灵活性。

您可以从多种样式的表单或文档中提取统一的结构化信息，并根据字段设定的标准类型完成自动格式转换。您可以根据下游系统的字段和结构要求来定义抽取JSON schema，以实现API"即插即用"的效果。例如，当您想要完成文档数据自动化录入系统时，文档抽取v3可以帮助您小时级完成从复杂文档到系统结构化数据的无缝衔接。

<Accordion title="新增功能" icon="sparkles">
  1. 支持更灵活的file传参，兼容`file_url`和`file_base64`
  2. 支持设定字段类型，包括常见的文本、数字、日期等格式
  3. 支持抽取多个表格，且限定抽取范围
</Accordion>

## 文档抽取v3配置

### JSON schema 结构示例

在文档抽取v3中最核心的配置是JSON schema，其结构示例如下：

```json
    "schema": {
        "type": "object",
        "properties": {
            "商品": {
            "type": [
                "string",
                "null"
            ],
            "description": ""
            },
            "商品列表": {
                "type": "array",
                "description": "",
                "items": {
                    "type": "object",
                    "properties": {
                        "名称": {
                            "type": ["string","null"],
                            "description": ""
                        },
                        "类型": {
                            "type": ["string","null"],
                            "description": ""
                        }
                    },
                    "required": ["名称","类型"]
                }
            }
        },
        "required": [
            "商品",
            "商品列表"
        ]
        }
```

### JSON schema 字段说明和抽取指南

- **schema**：完整的schema数据结构
  - **type**：schema的类型，固定为"object"
  - **properties**：抽取字段的集合
    - **name**：要抽取的字段名称
      - **type**：要抽取的字段类型
      - **enum**：当type为"enum"时，该字段表示抽取字段的枚举值
      - **description**：要抽取的字段描述
  - **required**：抽取字段的顺序要求，用字段名称排序表示

在定义要抽取的数据时，您需要为每个字段提供一个名称，以及确定该字段的类型。您还可以添加可选的字段描述为大模型提供更多的上下文。字段名称和字段描述均可作为抽取指导，帮助文档抽取v3准确了解需要从文档中查找和提取哪些信息。字段名称和描述越具体、越具有描述性，文档抽取v3就越能准确地识别和抽取文档中的正确数据。

### JSON schema 支持的字段数量

为了获得最佳性能，保障抽取的精度和速度，在JSON schema中包含的最低层级字段数量限制总计应不超过100个。

### JSON schema 支持的字段类型

- string：字符串
- number：数字
- integer：整数
- boolean：布尔值，仅含 `true`和`flase`
- enum：枚举
- object：对象。对象内可以包含以下类型：字符串、数字、整数、布尔值、枚举。
- array：数组。数组内可以包含以下类型：字符串、数字、整数、布尔值、枚举、对象。

请注意，在JSON schema中array、object、enum类型均支持层级嵌套结构，以便于抽取如表格类的数据或根据枚举值进行判断。但目前文档抽取v3仅支持最多不超过3级的嵌套，例如：

- array
  - object
    - string

### 更多入参说明

| **字段**                | **字段类型**  | **说明**                          |
| --------------------- | --------- | ------------------------------- |
| file                  | `object`  |                                 |
| -- file_url           | `string`  | 待处理文件的url链接，与file_base64二选一     |
| -- file_base64        | `string`  | 待处理文件的base64编码，与file_url二选一     |
| -- file_name          | `string`  | 用于前端展示的文件名，可选                   |
| parse_options         | `object`  | 用于透传文档解析接口的参数，详细使用方式请参考：文档解析API |
| extract_options       | `object`  | 用于控制更多抽取的高级功能                   |
| -- generate_citations | `boolean` | 是否生成坐标，默认为`true`                |
| -- stamp              | `boolean` | 是否开启印章识别，默认为`true`              |

## 使用文档抽取v3 API：快速启动

<Tip>
  调用[**API**](https://docs.textin.com/api-reference/endpoint/extract-v3)即可抽取数据。首先创建好要抽取字段的 JSON schema，之后您可以在API调用中快速使用它。
</Tip>

您也可以参考以下示例文件和示例代码，快速验证并将文档抽取v3接入到您的系统和应用流程中。

### 示例文件

<Tip>
  这里为您提供了一份Textin官方示例图片，您可以点击下载使用：[文档抽取png示例.png](https://web-api.textin.com/open/image/download?filename=54efc36a05cf475aa6b39137b0717726)

  ![Sample Image Pn](/images/sample_image.webp)
</Tip>

### 请求示例

```python
import requests

url = "https://api.textin.com/ai/service/v3/entity_extraction"

payload = {
    "file": {
        "file_url": "https://web-api.textin.com/open/image/download?filename=54efc36a05cf475aa6b39137b0717726"
    },
    "schema": {
        "type": "object",
        "properties": {
            "商品": {
            "type": [
                "string",
                "null"
            ],
            "description": ""
            },
            "商品列表": {
                "type": "array",
                "description": "",
                "items": {
                    "type": "object",
                    "properties": {
                        "名称": {
                            "type": ["string","null"],
                            "description": ""
                        },
                        "类型": {
                            "type": ["string","null"],
                            "description": ""
                        }
                    },
                    "required": ["名称","类型"]
                }
            }
        },
        "required": [
            "商品",
            "商品列表"
        ]
        },
    "parse_options":{
        "crop_dewarp":1,
        "get_image":"both"
    },
    "extract_options":{
        "generate_citations": "true",
        "stamp": "true"
    }
}
headers = {
    "x-ti-app-id": "<api-key>",    #需替换为你的x-ti-app-id
    "x-ti-secret-code": "<api-key>",    #需替换为你的x-ti-secret-code
    "Content-Type": "application/json"
}

response = requests.post(url, json=payload, headers=headers)

print(response.json())
```

### 返回示例

```json
{
  "code": 200,
  "message": "success",
  "version": "v3.0.29_20250819",
  "duration": 8267,
  "x_request_id": "7596b8c9d2ddbc9924b66651e9efc174",
  "status": "finished",
  "result": {
    "success_count": 1,
    "extracted_schema": {
      "商品": "童装 Looney Tunes UT（短袖T恤）女装SUPIMA COTTON圆领T恤（短袖）",
      "商品列表": [
        {
          "名称": "童装 Looney Tunes UT（短袖T恤）",
          "类型": "童装"
        },
        {
          "名称": "女装SUPIMA COTTON圆领T恤（短袖）",
          "类型": "女装"
        }
      ]
    },
    "citations": {
      "商品": {
        "value": "童装 Looney Tunes UT（短袖T恤）女装SUPIMA COTTON圆领T恤（短袖）",
        "bounding_regions": [
          {
            "page_number": 1,
            "position": [
              0.106667,
              0.350877,
              0.661667,
              0.350877,
              0.661667,
              0.366228,
              0.106667,
              0.366228
            ],
            "text": "童装 Looney Tunes UT（短袖T恤）"
          }
        ],
        "confidence": "high"
      }
    },
    "pages": [
      {
        "page_number": 1,
        "image_id": "62bfe3c3a8e9c9cf.jpg",
        "height": 1824,
        "width": 600,
        "angle": 0,
        "status": "Success",
        "durations": 930.178466796875
      }
    ],
    "stamps": [
      {
        "color": "红色",
        "position": [
          0.956,
          0.583,
          0.962,
          0.59,
          0.955,
          0.99,
          0.95,
          0.983
        ],
        "stamp_shape": "圆章",
        "type": "公章",
        "value": "电力公司专用章"
      }
    ]
  },
  "part_durations": {
    "parse_duration": 1080,
    "retrieve_duration": 0,
    "prompt_duration": 1,
    "llm_duration": 7114,
    "format_duration": 51
  }
}
```

## 返回结果说明

### 常规字段说明

- x_request_id：该请求的唯一标识
- code：错误码，200表示成功。详情见[**API**](https://docs.textin.com/api-reference/endpoint/extract-v3#response-code)说明
- message：错误信息，成功时为”success”
- version：版本号，例如”v3.0.29_20250819”
- duration：总耗时(毫秒)，例如”8267”
- status：处理状态，例如"finished"

### 主要结果说明：result对象

文档抽取v3会在返回结果的result对象中包含以下关键信息。

- **success_count**：成功处理的文档页数

#### extracted_schema：结构化的抽取结果，key-value形式

- **key：value**

抽取字段property是key-value形式的键值对结构。其key在JSON schema的properties中被定义和使用，包括name、type、description这三个关键字段要素，其value则是实际抽取所得到的结果。在result结果中key即为抽取字段名，与传入的schema结构一致；value为该字段对应的抽取结果。

#### citations：抽取结果的详细信息，包含坐标位置

- **key**：抽取字段
  - **value**：该字段的抽取结果
  - **bounding_regions**：抽取结果value对应的相对坐标位置
    - **page_number**：所在页码，从1开始
    - **text**：边界框所在区域内的文本内容
    - **position**：归一化坐标位置，长度为8的数组，表示四个顶点的坐标 [左上x, 左上y, 右上x, 右上y, 右下x, 右下y, 左下x, 左下y] 坐标值范围为[0,1]，相对于页面宽高的比例
  - **confidence**：置信度等级，可选值有：hign、medium、low

#### stamps：印章相关信息

- **stamps**：印章识别结果
  - **color**：当前印章颜色，可选值有：红色、蓝色、黑色、其他
  - **position**：印章的归一化坐标信息
  - **stamp_shape**：当前印章形状，可选值有：圆章、椭圆章、方章、三角章、菱形章、其他
  - **type**：当前印章类型，可选值有：公章、个人章、专用章、其他、合同专用章、财务专用章、发票专用章、业务专用章
  - **value**：印章的文本内容

#### pages：文档页面相关信息

- **page_number**：当前页码
- **image_id**：当前页面图片id
- **height**：文档页面高度
- **width**：文档页面宽度
- **angle**：页面角度（可选值0, 90, 180, 270)
- **status**：当前页处理状态，success或者error_message
- **durations**：当前页处理耗时(毫秒)

#### part_durations：各阶段耗时统计

- **parse_duration**：解析耗时(毫秒)
- **retrieve_duration**：检索耗时(毫秒)
- **prompt_duration**：提示词处理耗时(毫秒)
- **llm_duration**：大模型推理耗时(毫秒)
- **format_duration**：格式化耗时(毫秒)